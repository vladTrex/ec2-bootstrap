name: Example - Use GHCR Image

on:
  workflow_dispatch:

jobs:
  use-image:
    name: Use Docker Image from GHCR
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: read

    steps:
    - name: Log in to GitHub Container Registry
      uses: docker/login-action@v3
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    - name: Set image name to lowercase
      id: image
      run: |
        IMAGE_LOWER=$(echo "${{ github.repository }}" | tr '[:upper:]' '[:lower:]')
        echo "image=$IMAGE_LOWER" >> $GITHUB_OUTPUT

    - name: Pull Docker image
      run: |
        docker pull ghcr.io/${{ steps.image.outputs.image }}:latest

    - name: Run container
      run: |
        docker run --rm \
          -p 3030:3030 \
          ghcr.io/${{ steps.image.outputs.image }}:latest

    - name: Test the running container
      run: |
        sleep 5
        curl -f http://localhost:3030/health || exit 1

